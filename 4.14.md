# 4.14

## Question

Eva Lu Ator and Louis Reasoner are each experimenting with the metacircular evaluator. Eva types in the definition of `map`, and runs some test programs that use it. They work fine. Louis, in contrast, has installed the system version of `map` as a primitive for the metacircular evaluator. When he tries it, things go terribly wrong. Explain why Louis's map fails even though Eva's works.

## Answer

The system `map` is not designed to handle metacircular procedure representations. Attempting this yields catastrophic-looking error messages:

```scheme
;;; M-Eval input:
(map (lambda (x) (+ x x)) (list 1 2 3))
;The object (procedure (x) ((+ x x)) (((*unassigned* false true car cdr map caar cadr cdar cddr caaar caadr cadar caddr cdaar cdadr cddar cdddr caaaar caaadr caadar caaddr cadaar cadadr caddar cadddr cdaaar cdaadr cdadar cdaddr cddaar cddadr cdddar cddddr member set-car! set-cdr! apropos pp length cons list assoc null? number? string? symbol? pair? list? + - * / = < > abs remainder not eq? equal? memq make-hash-table hash-table/put! hash-table/get display newline read read-file error bkpt debug exit) #f #f #t (primitive #[compiled-procedure 12 ("list" #x1) #x1c #x10e458824]) (primitive #[compiled-procedure 13 ("list" #x2) #x1c #x10e45889c]) (primitive #[arity-dispatched-procedure 14]) (primitive #[compiled-procedure 15 ("list" #x29) #x1c #x10e45cb04]) (primitive #[compiled-procedure 16 ("list" #x2a) #x1c #x10e45cc94]) (primitive #[compiled-procedure 17 ("list" #x2b) #x1c #x10e45ce54]) (primitive #[compiled-procedure 18 ("list" #x2c) #x1c #x10e45d014]) (primitive #[compiled-procedure 19 ("list" #x2d) #x1c #x10e45d1ac]) (primitive #[compiled-procedure 20 ("list" #x2e) #x1c #x10e45d3c4]) (primitive #[compiled-procedure 21 ("list" #x2f) #x1c #x10e45d5fc]) (primitive #[compiled-procedure 22 ("list" #x30) #x1c #x10e45d83c]) (primitive #[compiled-procedure 23 ("list" #x31) #x1c #x10e45da7c]) (primitive #[compiled-procedure 24 ("list" #x32) #x1c #x10e45dcb4]) (primitive #[compiled-procedure 25 ("list" #x33) #x1c #x10e45def4]) (primitive #[compiled-procedure 26 ("list" #x34) #x1c #x10e45e134]) (primitive #[compiled-procedure 27 ("list" #x35) #x1c #x10e45e34c]) (primitive #[compiled-procedure 28 ("list" #x36) #x1c #x10e45e5e4]) (primitive #[compiled-procedure 29 ("list" #x37) #x1c #x10e45e89c]) (primitive #[compiled-procedure 30 ("list" #x38) #x1c #x10e45eb5c]) (primitive #[compiled-procedure 31 ("list" #x39) #x1c #x10e45ee14]) (primitive #[compiled-procedure 32 ("list" #x3a) #x1c #x10e45f0cc]) (primitive #[compiled-procedure 33 ("list" #x3b) #x1c #x10e45f38c]) (primitive #[compiled-procedure 34 ("list" #x3c) #x1c #x10e45f644]) (primitive #[compiled-procedure 35 ("list" #x3d) #x1c #x10e45f904]) (primitive #[compiled-procedure 36 ("list" #x3e) #x1c #x10e45fbbc]) (primitive #[compiled-procedure 37 ("list" #x3f) #x1c #x10e45fe74]) (primitive #[compiled-procedure 38 ("list" #x40) #x1c #x10e460134]) (primitive #[compiled-procedure 39 ("list" #x41) #x1c #x10e4603f4]) (primitive #[compiled-procedure 40 ("list" #x42) #x1c #x10e4606ac]) (primitive #[compiled-procedure 41 ("list" #x43) #x1c #x10e46096c]) (primitive #[compiled-procedure 42 ("list" #x44) #x1c #x10e460c2c]) (primitive #[compiled-procedure 43 ("list" #x7e) #x1c #x10e46efe4]) (primitive #[compiled-procedure 44 ("list" #x7) #x1c #x10e458a6c]) (primitive #[compiled-procedure 45 ("list" #x8) #x1c #x10e458af4]) (primitive #[compiled-procedure 46 ("apropos" #x1) #x1c #x10dfd48fc]) (primitive #[compiled-procedure 47 ("pp" #x17) #x1c #x10e1207e4]) (primitive #[compiled-procedure 48 ("list" #x1a) #x1c #x10e45abac]) (primitive #[compiled-procedure 49 ("list" #x3) #x1c #x10e458914]) (primitive #[compiled-procedure 50 ("list" #x9) #x1c #x10e458b7c]) (primitive #[compiled-procedure 51 ("list" #x93) #x1c #x10e474a74]) (primitive #[compiled-procedure 52 ("list" #x5) #x1c #x10e4589c4]) (primitive #[compiled-procedure 53 ("arith" #xf0) #x1c #x10e1a0eb4]) (primitive #[compiled-procedure 54 ("string" #x43) #x1c #x10e41d2d4]) (primitive #[compiled-procedure 55 ("symbol" #x1) #x1c #x10e416fbc]) (primitive #[compiled-procedure 56 ("list" #x6) #x1c #x10e458a1c]) (primitive #[compiled-procedure 57 ("list" #x11) #x1c #x10e45993c]) (primitive #[arity-dispatched-procedure 58]) (primitive #[arity-dispatched-procedure 59]) (primitive #[arity-dispatched-procedure 60]) (primitive #[arity-dispatched-procedure 61]) (primitive #[arity-dispatched-procedure 62]) (primitive #[arity-dispatched-procedure 63]) (primitive #[arity-dispatched-procedure 64]) (primitive #[compiled-procedure 65 ("arith" #x112) #x1c #x10e1a7fa4]) (primitive #[compiled-procedure 66 ("arith" #x189) #x1c #x10e1baecc]) (primitive #[compiled-procedure 67 ("boole" #x1) #x1c #x10e3cb38c]) (primitive #[compiled-procedure 68 ("equals" #x1) #x1c #x10e48f56c]) (primitive #[compiled-procedure 69 ("equals" #x3) #x1c #x10e48f6cc]) (primitive #[compiled-procedure 70 ("list" #x7c) #x1c #x10e46eb94]) (primitive #[compiled-procedure 71 ("hash-table" #x25) #x1c #x10e233c84]) (primitive #[compiled-procedure 72 ("hash-table" #x35) #x1c #x10e23795c]) (primitive #[compiled-procedure 73 ("hash-table" #x33) #x1c #x10e236f44]) (primitive #[compiled-procedure 74 ("output-port" #x16) #x1c #x10e1edb8c]) (primitive #[compiled-procedure 75 ("output-port" #x10) #x1c #x10e1ed5c4]) (primitive #[compiled-procedure 76 ("input-port" #x17) #x1c #x10e1f3f6c]) (primitive #[compiled-procedure 77 ("input-port" #x18) #x1c #x10e1f4034]) (primitive #[compiled-procedure 78 ("error" #x60) #x1c #x10e2bfc9c]) (primitive #[compiled-procedure 79 ("rep" #x71) #x1c #x10e1030dc]) (primitive #[compiled-procedure 80 ("debug" #x1) #x1c #x10e30571c]) (primitive #[compiled-procedure 81 ("global" #x40) #x1c #x10e3b369c])))) is not applicable.
;To continue, call RESTART with an option number:
; (RESTART 2) => Specify a procedure to use in its place.
; (RESTART 1) => Return to read-eval-print level 1.
```

Eva's `map` works because it is written in terms of the metacircular procedures.
